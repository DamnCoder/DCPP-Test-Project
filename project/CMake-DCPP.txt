# External projects
INCLUDE(ExternalProject)

SET(DCPP PROJECT_DCPP)

SET(DCPP_INCLUDE_DIRS "${EXTERNALS_PATH}/dcpp/project/include")
SET(DCPP_LIBRARY "${CMAKE_STATIC_LIBRARY_PREFIX}DCPP${CMAKE_STATIC_LIBRARY_SUFFIX}")
SET(DCPP_BUILD_DIR ${PROJECT_BINARY_DIR}/DCPP-build)

MESSAGE(STATUS "External project name: " ${DCPP})
MESSAGE(STATUS "Externals path" ${EXTERNALS_PATH})
MESSAGE(STATUS "DCCP Library name " ${DCPP_LIBRARY})
MESSAGE(STATUS "DCCP install dir " ${DCPPTEST_LIBRARY_OUTPUT_PATH})

EXTERNALPROJECT_ADD(
	${DCPP}

	#PREFIX "${DCPPTEST_LIBRARY_OUTPUT_PATH}"

	GIT_REPOSITORY "https://github.com/DamnCoder/DCPP.git"
  GIT_TAG "development"

  UPDATE_COMMAND ${GIT_EXECUTABLE} pull

  PATCH_COMMAND ""
	INSTALL_COMMAND ""
	CONFIGURE_COMMAND ${CMAKE_COMMAND} 
        ${EXTERNALS_PATH}/dcpp/project # Tell CMake to use subdirectory as source.

  SOURCE_DIR ${EXTERNALS_PATH}/dcpp
  BINARY_DIR ${DCPP_BUILD_DIR}
	INSTALL_DIR ${DCPPTEST_LIBRARY_OUTPUT_PATH}
)

EXTERNALPROJECT_ADD_STEP(
  ${DCPP} CopyToBin
  COMMAND ${CMAKE_COMMAND} -E copy_directory ${DCPP_INCLUDE_DIRS} ${DCPPTEST_LIBRARY_OUTPUT_PATH}/include
  DEPENDEES install
)

EXTERNALPROJECT_GET_PROPERTY(${DCPP} INSTALL_DIR)

ADD_LIBRARY(DCPP STATIC IMPORTED)

ADD_DEPENDENCIES(DCPP ${DCPP})

SET_PROPERTY(TARGET DCPP PROPERTY IMPORTED_LOCATION ${DCPP_BUILD_DIR}/lib/${DCPP_LIBRARY})

MESSAGE(STATUS "DCCP Install dir " ${INSTALL_DIR})

INCLUDE_DIRECTORIES(${DCPP_INCLUDE_DIRS})

MESSAGE(STATUS " INCLUDE DIR: " ${DCPP_INCLUDE_DIRS})